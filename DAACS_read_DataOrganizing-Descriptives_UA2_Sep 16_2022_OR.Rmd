---
title: "DAACS_read_DataOrganizing_UA2_Sep16_2022_OR"
author: "Oxana Rosca"
date: "2022-11-12"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(psych)
library(ggplot2)
library(maditr)
library(stringr)
library(haven)
```

If needed:
setwd("D:OneDrive - University at Albany - SUNY/WorkDirectory")

Load umgc1 data files to get umgc1's variable "qid"
```{r}
load("data_export/DAACS-Results-umgc_2022-09-16.rda")
umgc1.read.items.questions<-read.items.questions
```

To distinguish between the QIDs of the math and reading sets, use str_replace() 
method from stringr package to replace part of a column string with another 
string. 
```{r}
#library(stringr)
umgc1.read.items.questions$qid <- str_replace(umgc1.read.items.questions$qid, 
                                              "Q", "rQ")
```

Load data files
```{r}
load("data_export/DAACS-Results-albany_2022-09-16.rda.")
```

*Duplicates*
Test for duplicate values in daacs
Frequencies: How many of non-duplicated IDs?
```{r}
table(duplicated(daacs$DAACS_ID))
```
*Adjusting UA2's IDs*
To distinguish the DAACS_IDs of different colleges, always add 10,000 to UA2 
DAACS_IDs:
```{r}
daacs$DAACS_ID<-daacs$DAACS_ID+10000
read.items$DAACS_ID<-read.items$DAACS_ID+10000
```

```{r}
table(duplicated(read.items$DAACS_ID))
```
read.items is a long dataset with many rows per a test-taker.

*Consistent QID*

For all analyses involving the data from more than one college, we need 
consistent QID (question ID) values. The QIDs were generated by DAACS 
individually for every college during data collection. 

Because the students at UA2 responded to 174 math questions while the students 
at UMGC1 responded to 175 math questions, I decided to rename the "qid" variable 
generated for the UMGC1 into "uniqueQID" and replace the "qid" variable in UA2 
data by the "uniqueQID" using the items stems variable "question" as a matching 
variable. I do the same process for the reading items although the students of 
the both colleges responded to the same number (180) of the reading items. 

Remove UAlbany2's qid variable
```{r}
read.items<-read.items[,-11]
```
Add UMGC1's qid variable
```{r}
read.items <- merge(read.items,umgc1.read.items.questions,by = 'question', 
                       all.x = TRUE)
```

*Attempts*
How many of each number of attempts?
```{r}
table(read.items$attempt, useNA = 'ifany') %>% print() %>% prop.table()* 100
```

Select the first attempts only
```{r}
read.items <- read.items [read.items$attempt == "1",]
```

*Restructure*
re-structure =long dataset from wide dataset
```{r}
#library(maditr)
ua2ReadDaacs <- dcast(read.items,DAACS_ID ~ qid,value.var = 'score')
```

*Merge*
Using all.y = TRUE so that we use only students provided from 
UA2. These are all newly enrolled students' data on Sep 16th, 2022 (Removing all 
students that did not take read assessment)
```{r}
ua2ReadDaacs <- merge(daacs,ua2ReadDaacs,by = 'DAACS_ID', all.y = TRUE)
```

*Test Time*
Calculate test time in minutes per student:
```{r}
ua2ReadDaacs$readTime= (ua2ReadDaacs$readCompletionDate - 
                          ua2ReadDaacs$readStartDate)/60
```

To remove the non-numeric substring "sec" from the values of readTime
```{r}
time_var_temp <- 
lapply(ua2ReadDaacs[242],function(x)as.numeric(sub("\\s+\\D+$","",x)))
time_var_temp<-as.data.frame(time_var_temp)
View(time_var_temp)
ua2ReadDaacs$readTime<-time_var_temp$readTime
View(ua2ReadDaacs)
```


see the minimum value in minutes
```{r}
min(ua2ReadDaacs$readTime)
```
What is the shortest time in minutes for a student to get a perfect score
```{r}
min(ua2ReadDaacs[ua2ReadDaacs$readTotal == 1.0,]$readTime)
```
To get at least 70%
```{r}
min(ua2ReadDaacs[ua2ReadDaacs$readTotal >= .7,]$readTime)
```
How many took less than 3.5 minutes
```{r}
nrow(ua2ReadDaacs[ua2ReadDaacs$readTime <= 3.5,])
```
To create a separate dataset of speedy students,
1)Create a vector of the row numbers of the speedy students:
```{r}
speedy<-which (ua2ReadDaacs$readTime <= 3.5)
```

2)subset the rows of the speedy students as a dataframe:
```{r}
ua2ReadSpeedy<-ua2ReadDaacs[speedy, ]
ua2ReadSpeedy[,c(1,42,242)]
```

```{r}
ua2ReadSpeedy$DAACS_ID
```

3 speedy students with DAACS_ID 10195, 10850, and 11053 took less than 3.5 
minutes for the reading assessment and less than 3 minutes for the math 
assessment.
4 speedy student with DAACS_ID 10245, 10454, 10549, and 10972 took less than 3 
minutes for the reading assessment.


Remove 7 speedy students (who completed the assesment in 3.5 minutes or less)
```{r}
ua2ReadDaacs <- ua2ReadDaacs[ua2ReadDaacs$readTime > 3.5,]
```

*Total Score*
Histogram of the read scores in points
```{r}
#library(ggplot2)
ggplot(ua2ReadDaacs, aes(x = readTotal)) + 
  geom_histogram(binwidth = 0.055, show.legend = TRUE, color = "purple", 
                 fill = "#999999", alpha = 1) + xlab('read Total') +   
                    ylab('Number of Students')
```
Cut the variable of scores into three categories of dots
```{r}
ua2ReadDaacs$readTotalDots <- cut(ua2ReadDaacs$readTotal,
                              breaks=c(0, 0.7, 0.9, 1),labels=c('1', '2', '3'))
```

To build a bar-plot of the read scores in dots
```{r}
table(ua2ReadDaacs$readTotalDots,
      useNA = 'ifany') %>% print() %>% prop.table()* 100
```

```{r}
barplot(table(ua2ReadDaacs$readTotalDots),main="ua2 read Total Score in Dots",
          xlab="read Total in Dots", ylab="Number of Students", border="purple", 
              col="grey", density=100)
```

To check if there are empty rows:
```{r}
ua2ReadDaacs_Check<-
  ua2ReadDaacs[rowSums(is.na(ua2ReadDaacs))!=ncol(ua2ReadDaacs),]
```
Comparing the # of cases, there are no empty rows

*Save New File*

Adding a variable of college and saving the new data file:
```{r}
ua2ReadDaacs$college <- 'UA2'
saveRDS(ua2ReadDaacs, file = 'ua2ReadDaacs.rds')
write_sav(ua2ReadDaacs, "ua2ReadDaacs.sav")
write.table(ua2ReadDaacs, 'ua2ReadDaacs.csv', sep=',')
saveRDS(ua2ReadSpeedy, file = 'ua2ReadSpeedy.rds')
write_sav(ua2ReadSpeedy, "ua2ReadSpeedy.sav")
write.table(ua2ReadSpeedy, 'ua2ReadSpeedy.csv', sep=',')
```

*Total Number of Participants and Demographics*
how many paricipants and variables you have 
```{r}
dim(ua2ReadDaacs)
```
Descriptive statistics for reading items. Saving the .cvs
```{r}
describe_ua2ReadDaacs<-describe(ua2ReadDaacs[,c(37:44,62:243)], na.rm = TRUE)
#write.table(describe_ua2ReadDaacs, 'ua2ReadDaacs_Descriptives.csv', sep=',')
describe_ua2ReadDaacs
```





